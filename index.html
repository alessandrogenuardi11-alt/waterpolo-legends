<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterpolo Legends</title>

<style>
body{margin:0;background:#1e90ff;font-family:Arial;overflow:hidden}
canvas{display:block}

#menu{
position:fixed;
top:50%;left:50%;
transform:translate(-50%,-50%);
background:white;
padding:20px;
border-radius:12px;
text-align:center;
z-index:10;
}

#ui{
position:fixed;
top:10px;left:10px;
color:white;
font-size:18px;
}

#message{
position:fixed;
top:50%;left:50%;
transform:translate(-50%,-50%);
color:white;
font-size:40px;
font-weight:bold;
display:none;
}

#joy{
position:fixed;
bottom:140px;
left:30px;
width:90px;height:90px;
background:rgba(255,255,255,0.3);
border-radius:50%;
}
#stick{
width:35px;height:35px;
background:white;
border-radius:50%;
position:absolute;
left:27px;top:27px;
}

#controls{
position:fixed;
bottom:140px;
right:20px;
}

button{
padding:10px;
margin:6px;
border-radius:8px;
}
</style>
</head>

<body>

<div id="menu">
<h2>Waterpolo Legends</h2>
<button onclick="startGame('bot')">ðŸ¤– BOT</button><br>
<button onclick="startGame('friend')">ðŸ‘¬ AMICO</button>
</div>

<canvas id="game"></canvas>

<div id="ui">
ðŸŸ¡ <span id="scoreY">0</span> - ðŸ”´ <span id="scoreR">0</span>
</div>

<div id="message">CENTROCAMPO</div>

<div id="joy"><div id="stick"></div></div>

<div id="controls">
<button onclick="passBall()">PASSA</button>
<button onclick="shoot()">TIRA</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let mode="bot";
let scoreY=0,scoreR=0;

let playerStart={x:canvas.width/2,y:canvas.height-150};
let player={...playerStart};

let mates=[
{x:canvas.width/2-120,y:canvas.height-230},
{x:canvas.width/2+120,y:canvas.height-230}
];

let enemies=[
{x:canvas.width/2,y:canvas.height/2},
{x:canvas.width/2-150,y:canvas.height/2+60},
{x:canvas.width/2+150,y:canvas.height/2+60}
];

let ball={
x:player.x,
y:player.y-20,
vx:0,vy:0,
state:"attached"
};

function startGame(m){
mode=m;
document.getElementById("menu").style.display="none";
loop();
}

function drawCircle(p,r,c){
ctx.fillStyle=c;
ctx.beginPath();
ctx.arc(p.x,p.y,r,0,Math.PI*2);
ctx.fill();
}

function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);

// PALLA
if(ball.state==="attached"){
ball.x=player.x;
ball.y=player.y-20;
}else{
ball.x+=ball.vx;
ball.y+=ball.vy;
}

// BOT MOVIMENTO (solo il piÃ¹ vicino)
if(mode==="bot"){
let closest=null;
let minDist=99999;

enemies.forEach(e=>{
let d=Math.hypot(player.x-e.x,player.y-e.y);
if(d<minDist){
minDist=d;
closest=e;
}
});

// solo il piÃ¹ vicino si muove
if(closest){
let dx=player.x-closest.x;
let dy=player.y-closest.y;
let d=Math.hypot(dx,dy);
closest.x+=dx/d*1.5;
closest.y+=dy/d*1.5;

// se ti tocca e hai palla
if(d<25 && ball.state==="attached"){
showMidfield();
}
}
}

// DISEGNO
drawCircle(player,18,"yellow");
mates.forEach(m=>drawCircle(m,18,"yellow"));
if(mode==="bot"){
enemies.forEach(e=>drawCircle(e,18,"red"));
}
drawCircle(ball,7,"white");

requestAnimationFrame(loop);
}

function passBall(){
if(ball.state!=="attached") return;
let target=mates[0];
let dx=target.x-player.x;
let dy=target.y-player.y;
let d=Math.hypot(dx,dy);
ball.state="pass";
ball.vx=dx/d*6;
ball.vy=dy/d*6;
}

function shoot(){
if(ball.state!=="attached") return;
ball.state="shot";
ball.vx=0;
ball.vy=-10;
}

function showMidfield(){
document.getElementById("message").style.display="block";
resetPositions();
setTimeout(()=>{
document.getElementById("message").style.display="none";
},1500);
}

function resetPositions(){
player={...playerStart};
ball.state="attached";
ball.vx=0;
ball.vy=0;
}

// JOYSTICK
const joy=document.getElementById("joy");
const stick=document.getElementById("stick");
let active=false;

joy.ontouchstart=()=>active=true;
joy.ontouchend=()=>{
active=false;
stick.style.left="27px";
stick.style.top="27px";
};

joy.ontouchmove=e=>{
if(!active)return;
let r=joy.getBoundingClientRect();
let x=e.touches[0].clientX-r.left-45;
let y=e.touches[0].clientY-r.top-45;
player.x+=x*0.08;
player.y+=y*0.08;
};
</script>
</body>
</html>
