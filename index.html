<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterpolo Legends</title>

<style>
body{margin:0;background:#1e90ff;overflow:hidden;font-family:Arial}
canvas{display:block}

#home{
position:fixed;top:50%;left:50%;
transform:translate(-50%,-50%);
background:white;padding:25px;
border-radius:15px;text-align:center;
z-index:10;
}

#ui{
position:fixed;top:10px;left:10px;
color:white;font-size:18px;
}

.joy{
position:absolute;width:90px;height:90px;
background:rgba(255,255,255,0.3);
border-radius:50%;
}
.stick{
width:35px;height:35px;
background:white;border-radius:50%;
position:absolute;left:27px;top:27px;
}

.controlsY{position:fixed;bottom:130px;right:10px}

button{padding:10px;margin:4px;border-radius:8px}

#midfield{
position:fixed;left:50%;bottom:200px;
transform:translateX(-50%);
display:none;
}
</style>
</head>

<body>

<div id="home">
<h2>Waterpolo Legends</h2>
<button onclick="startGame()">GIOCA</button>
</div>

<canvas id="game"></canvas>

<div id="ui">
ðŸŸ¡ <span id="scoreY">0</span> - ðŸ”´ <span id="scoreR">0</span>
</div>

<div id="joyY" class="joy"><div class="stick"></div></div>

<div class="controlsY">
<button onclick="passBall()">PASSA</button>
<button onclick="shoot()">TIRA</button>
</div>

<button id="midfield" onclick="resetAll()">CENTROCAMPO</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let scoreY=0,scoreR=0;

let teamY=[],teamR=[],ctrlY=null,ball;
let startY=[],startR=[];

const goalTop={x:canvas.width/2-100,y:20,w:200,h:30};
const goalBottom={x:canvas.width/2-100,y:canvas.height-50,w:200,h:30};

// PORTIERI
let keeperTop={x:goalTop.x+100,y:goalTop.y+15,dir:1};
let keeperBottom={x:goalBottom.x+100,y:goalBottom.y-15,dir:1};

// JOYSTICK POS
joyY.style.left="30px";
joyY.style.bottom="180px";

function startGame(){
home.style.display="none";
resetAll();
loop();
}

function resetAll(){
teamY=[
{x:canvas.width/2,y:canvas.height-160},
{x:canvas.width/2-120,y:canvas.height-240},
{x:canvas.width/2+120,y:canvas.height-240}
];

teamR=[
{x:canvas.width/2,y:canvas.height/2},
{x:canvas.width/2-140,y:canvas.height/2+60},
{x:canvas.width/2+140,y:canvas.height/2+60},
{x:canvas.width/2,y:canvas.height/2+120}
];

startY=JSON.parse(JSON.stringify(teamY));
startR=JSON.parse(JSON.stringify(teamR));

ctrlY=teamY[0];
ball={owner:"Y",x:ctrlY.x,y:ctrlY.y-20,vx:0,vy:0};

keeperTop.x=goalTop.x+goalTop.w/2;
keeperBottom.x=goalBottom.x+goalBottom.w/2;

midfield.style.display="none";
}

function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}

function draw(p,c){
ctx.fillStyle=c;
ctx.beginPath();
ctx.arc(p.x,p.y,18,0,Math.PI*2);
ctx.fill();
}

function loop(){
ctx.fillStyle="#1e90ff";
ctx.fillRect(0,0,canvas.width,canvas.height);

// PORTE
ctx.strokeStyle="white";
ctx.strokeRect(goalTop.x,goalTop.y,goalTop.w,goalTop.h);
ctx.strokeRect(goalBottom.x,goalBottom.y,goalBottom.w,goalBottom.h);

// PORTIERI MOVIMENTO
keeperTop.x+=keeperTop.dir*2;
if(keeperTop.x<goalTop.x+15||keeperTop.x>goalTop.x+goalTop.w-15) keeperTop.dir*=-1;

keeperBottom.x+=keeperBottom.dir*2;
if(keeperBottom.x<goalBottom.x+15||keeperBottom.x>goalBottom.x+goalBottom.w-15) keeperBottom.dir*=-1;

draw(keeperTop,"red");
draw(keeperBottom,"yellow");

// BOT: solo il piÃ¹ vicino quando hai palla
if(ball.owner==="Y"){
let closest=teamR.reduce((a,b)=>dist(b,ctrlY)<dist(a,ctrlY)?b:a);
let dx=ctrlY.x-closest.x;
let dy=ctrlY.y-closest.y;
let d=Math.hypot(dx,dy);
if(d>1){
closest.x+=dx/d*1.2;
closest.y+=dy/d*1.2;
}
if(d<25){
ball.owner="R";
midfield.style.display="block";
}
}

// PALLA
if(ball.owner==="Y"){
ball.x=ctrlY.x;
ball.y=ctrlY.y-20;
}else{
ball.x+=ball.vx;
ball.y+=ball.vy;
}

// GOAL
if(ball.x>goalTop.x&&ball.x<goalTop.x+goalTop.w&&ball.y<goalTop.y+goalTop.h){
scoreY++;resetAll();
}
if(ball.x>goalBottom.x&&ball.x<goalBottom.x+goalBottom.w&&ball.y>goalBottom.y){
scoreR++;resetAll();
}

// DISEGNO
teamY.forEach(p=>draw(p,"yellow"));
teamR.forEach(p=>draw(p,"red"));
draw(ball,"white");

scoreYEl.innerText=scoreY;
scoreREl.innerText=scoreR;

requestAnimationFrame(loop);
}

function passBall(){
let target=teamY.find(p=>p!==ctrlY);
ctrlY=target;
ball.owner="Y";
}

function shoot(){
if(ball.owner!=="Y") return;
ball.owner=null;
ball.vx=0;
ball.vy=-12;
}

// JOYSTICK
let active=false;
joyY.ontouchstart=()=>active=true;
joyY.ontouchend=()=>active=false;
joyY.ontouchmove=e=>{
if(!active)return;
let r=joyY.getBoundingClientRect();
let x=e.touches[0].clientX-r.left-45;
let y=e.touches[0].clientY-r.top-45;
ctrlY.x+=x*0.08;
ctrlY.y+=y*0.08;
};

const scoreYEl=document.getElementById("scoreY");
const scoreREl=document.getElementById("scoreR");
</script>
</body>
</html>
