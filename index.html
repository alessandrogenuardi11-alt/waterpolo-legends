<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterpolo Legends</title>
<style>
body{margin:0;background:#1e90ff;overflow:hidden;font-family:Arial}
canvas{display:block}
#ui{position:fixed;top:10px;left:10px;color:white;font-size:18px}
#controls{position:fixed;bottom:10px;width:100%;display:flex;justify-content:space-around;flex-wrap:wrap}
.btn{background:white;padding:12px 18px;border-radius:10px;margin:5px}
#restart{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:15px 25px}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
‚è±Ô∏è <span id="time">60</span> |
üü° <span id="scoreY">0</span> - üî¥ <span id="scoreR">0</span>
</div>

<div id="controls">
<button class="btn" id="left">‚¨Ö</button>
<button class="btn" id="right">‚û°</button>
<button class="btn" id="forward">‚¨Ü</button>
<button class="btn" id="back">‚¨á</button>
<button class="btn" id="pass">PASSA</button>
<button class="btn" id="shoot">TIRA</button>
</div>

<button id="restart">Ricomincia</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let time=60,scoreY=0,scoreR=0,gameOver=false;

// SQUADRA GIALLA
let teamY=[
{x:canvas.width/2,y:canvas.height-150,hasBall:true},
{x:canvas.width/2-120,y:canvas.height-220,hasBall:false},
{x:canvas.width/2+120,y:canvas.height-220,hasBall:false}
];
let controlled=teamY[0];

// SQUADRA ROSSA
let teamR=[
{x:canvas.width/2,y:canvas.height/2},
{x:canvas.width/2-100,y:canvas.height/2+60},
{x:canvas.width/2+100,y:canvas.height/2+60}
];

let ball={x:controlled.x,y:controlled.y-25,owner:"Y"};

// PORTE
let goalTop={x:canvas.width/2-100,y:30,w:200,h:20};
let goalBottom={x:canvas.width/2-100,y:canvas.height-50,w:200,h:20};

function drawPlayer(p,color){
ctx.fillStyle=color;
ctx.beginPath();ctx.arc(p.x,p.y,18,0,Math.PI*2);ctx.fill();
ctx.fillStyle="#f2c9a0";
ctx.beginPath();ctx.arc(p.x,p.y-25,9,0,Math.PI*2);ctx.fill();
}

function reset(){
teamY[0]={x:canvas.width/2,y:canvas.height-150,hasBall:true};
teamY[1]={x:canvas.width/2-120,y:canvas.height-220,hasBall:false};
teamY[2]={x:canvas.width/2+120,y:canvas.height-220,hasBall:false};
controlled=teamY[0];
ball.owner="Y";
}

function update(){
ctx.fillStyle="#1e90ff";
ctx.fillRect(0,0,canvas.width,canvas.height);

// Porte
ctx.strokeStyle="white";
ctx.strokeRect(goalTop.x,goalTop.y,goalTop.w,goalTop.h);
ctx.strokeRect(goalBottom.x,goalBottom.y,goalBottom.w,goalBottom.h);

// AI ROSSA
teamR.forEach(r=>{
if(ball.owner==="Y"){
// inseguono chi ha la palla
if(r.x<controlled.x) r.x+=1.5;
if(r.x>controlled.x) r.x-=1.5;
if(r.y<controlled.y) r.y+=1.5;
if(r.y>controlled.y) r.y-=1.5;

// rubano palla
if(Math.abs(r.x-controlled.x)<20 && Math.abs(r.y-controlled.y)<20){
ball.owner="R";
}
}else{
// attaccano
if(r.y<goalBottom.y) r.y+=1.5;
if(r.x<goalBottom.x+goalBottom.w/2) r.x+=1;
if(r.x>goalBottom.x+goalBottom.w/2) r.x-=1;

if(r.y>goalBottom.y && r.x>goalBottom.x && r.x<goalBottom.x+goalBottom.w){
scoreR++;
reset();
}
}
});

// Posizione palla
if(ball.owner==="Y"){
ball.x=controlled.x;
ball.y=controlled.y-25;
}

// Disegno
teamY.forEach(p=>drawPlayer(p,"yellow"));
teamR.forEach(p=>drawPlayer(p,"red"));

ctx.fillStyle="white";
ctx.beginPath();ctx.arc(ball.x,ball.y,7,0,Math.PI*2);ctx.fill();

document.getElementById("scoreY").innerText=scoreY;
document.getElementById("scoreR").innerText=scoreR;

if(!gameOver) requestAnimationFrame(update);
}

// CONTROLLI
left.onclick=()=>controlled.x-=20;
right.onclick=()=>controlled.x+=20;
forward.onclick=()=>controlled.y-=20;
back.onclick=()=>controlled.y+=20;

pass.onclick=()=>{
let mates=teamY.filter(p=>p!==controlled);
let target=mates.reduce((a,b)=>Math.abs(b.x-controlled.x)<Math.abs(a.x-controlled.x)?b:a);
controlled=target;
ball.owner="Y";
};

shoot.onclick=()=>{
if(ball.owner==="Y"){
let shot=setInterval(()=>{
ball.y-=8;
if(ball.y<goalTop.y+goalTop.h && ball.x>goalTop.x && ball.x<goalTop.x+goalTop.w){
scoreY++;
clearInterval(shot);
reset();
}
if(ball.y<0) clearInterval(shot);
},16);
}
};

// TIMER
setInterval(()=>{
if(time>0){
time--;
document.getElementById("time").innerText=time;
}else{
gameOver=true;
document.getElementById("restart").style.display="block";
}
},1000);

restart.onclick=()=>{
scoreY=0;scoreR=0;time=60;
gameOver=false;
document.getElementById("restart").style.display="none";
reset();
update();
};

reset();
update();
</script>
</body>
</html>
