<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Waterpolo Legends</title>

<style>
body { margin:0; background:#1e90ff; overflow:hidden; font-family:Arial; }
canvas { display:block; }

#ui {
  position:fixed;
  top:10px; left:10px;
  color:white; font-size:18px;
}

#controls {
  position:fixed;
  bottom:15px;
  width:100%;
  display:flex;
  justify-content:space-around;
}

.btn {
  background:white;
  padding:12px;
  border-radius:10px;
  font-size:16px;
}

#restart {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  padding:15px 25px;
  font-size:20px;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="ui">
‚è±Ô∏è <span id="time">60</span> |
üèÜ <span id="score">0</span>
</div>

<div id="controls">
<button class="btn" id="back">‚¨á Indietro</button>
<button class="btn" id="forward">‚¨Ü Avanti</button>
<button class="btn" id="pass">PASSA</button>
<button class="btn" id="shoot">TIRA</button>
</div>

<button id="restart">Ricomincia</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let time = 60;
let score = 0;
let gameOver = false;

// GIOCATORI
let player = { x: canvas.width/2, y: canvas.height-140, hasBall:true };
let mate1 = { x: canvas.width/2-80, y: canvas.height-200 };
let mate2 = { x: canvas.width/2+80, y: canvas.height-200 };

let enemy1 = { x: canvas.width/2-60, y: canvas.height/2 };
let enemy2 = { x: canvas.width/2+60, y: canvas.height/2 };
let enemy3 = { x: canvas.width/2, y: canvas.height/2+60 };

// PORTIERI
let keeperTop = { x: canvas.width/2, y: 80, dir:1 };
let keeperBottom = { x: canvas.width/2, y: canvas.height-80, dir:1 };

// PORTE
let goalTop = { x: canvas.width/2-100, y: 40, w:200, h:20 };
let goalBottom = { x: canvas.width/2-100, y: canvas.height-40, w:200, h:20 };

// PALLA
let ball = { x: player.x, y: player.y-25, vx:0, vy:0 };

function drawPlayer(p,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.arc(p.x,p.y,18,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#f2c9a0";
  ctx.beginPath();
  ctx.arc(p.x,p.y-26,10,0,Math.PI*2);
  ctx.fill();
}

function draw(){
  ctx.fillStyle="#1e90ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="white";
  ctx.lineWidth=4;
  ctx.strokeRect(goalTop.x,goalTop.y,goalTop.w,goalTop.h);
  ctx.strokeRect(goalBottom.x,goalBottom.y,goalBottom.w,goalBottom.h);

  keeperTop.x += keeperTop.dir*2;
  if(keeperTop.x<goalTop.x+20||keeperTop.x>goalTop.x+goalTop.w-20) keeperTop.dir*=-1;

  keeperBottom.x += keeperBottom.dir*2;
  if(keeperBottom.x<goalBottom.x+20||keeperBottom.x>goalBottom.x+goalBottom.w-20) keeperBottom.dir*=-1;

  drawPlayer(player,"yellow");
  drawPlayer(mate1,"yellow");
  drawPlayer(mate2,"yellow");

  drawPlayer(enemy1,"red");
  drawPlayer(enemy2,"red");
  drawPlayer(enemy3,"red");

  drawPlayer(keeperTop,"blue");
  drawPlayer(keeperBottom,"blue");

  if(player.hasBall){
    ball.x=player.x;
    ball.y=player.y-25;
  } else {
    ball.x+=ball.vx;
    ball.y+=ball.vy;
  }

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,7,0,Math.PI*2);
  ctx.fill();

  // GOL
  if(ball.y<goalTop.y+goalTop.h && ball.x>goalTop.x && ball.x<goalTop.x+goalTop.w){
    score++;
    reset();
  }

  // RUBA PALLA
  [enemy1,enemy2,enemy3].forEach(e=>{
    if(Math.abs(player.x-e.x)<25 && Math.abs(player.y-e.y)<25){
      player.hasBall=false;
    }
  });

  document.getElementById("score").innerText=score;
  if(!gameOver) requestAnimationFrame(draw);
}

function reset(){
  player.x=canvas.width/2;
  player.y=canvas.height-140;
  player.hasBall=true;
  ball.vx=0; ball.vy=0;
}

// CONTROLLI
forward.onclick=()=>player.y-=20;
back.onclick=()=>player.y+=20;

pass.onclick=()=>{
  if(player.hasBall){
    player.hasBall=false;
    ball.vx=(mate1.x-player.x)/20;
    ball.vy=(mate1.y-player.y)/20;
  }
};

shoot.onclick=()=>{
  if(player.hasBall){
    player.hasBall=false;
    ball.vx=0;
    ball.vy=-10;
  }
};

// TIMER
setInterval(()=>{
  if(time>0){
    time--;
    document.getElementById("time").innerText=time;
  } else {
    gameOver=true;
    document.getElementById("restart").style.display="block";
  }
},1000);

restart.onclick=()=>{
  score=0;
  time=60;
  gameOver=false;
  restart.style.display="none";
  reset();
  draw();
};

draw();
</script>
</body>
</html>
