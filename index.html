<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterpolo Legends</title>

<style>
body{margin:0;background:#1e90ff;overflow:hidden;font-family:Arial}
canvas{display:block}
#home{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:white;padding:25px;border-radius:15px;text-align:center;z-index:10}
#ui{position:fixed;top:10px;left:10px;color:white;font-size:18px}

.joy{position:absolute;width:100px;height:100px;
background:rgba(255,255,255,0.25);border-radius:50%}
.stick{width:40px;height:40px;background:white;border-radius:50%;
position:absolute;left:30px;top:30px}

.controlsY{position:fixed;bottom:140px;right:15px}
button{padding:10px;border-radius:8px;margin:4px}
</style>
</head>

<body>

<div id="home">
<h2>Waterpolo Legends</h2>
<button onclick="startGame()">GIOCA</button>
</div>

<canvas id="game"></canvas>

<div id="ui">
ðŸŸ¡ <span id="scoreY">0</span> - ðŸ”´ <span id="scoreR">0</span>
</div>

<div id="joyY" class="joy"></div>
<div class="controlsY">
<button onclick="shoot()">TIRA</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let scoreY=0, scoreR=0;
let player, bot, ball;

const goalTop={x:canvas.width/2-100,y:20,w:200,h:30};
const goalBottom={x:canvas.width/2-100,y:canvas.height-50,w:200,h:30};

function startGame(){
document.getElementById("home").style.display="none";
reset();
loop();
}

function reset(){
player={x:canvas.width/2,y:canvas.height-160};
bot={x:canvas.width/2,y:canvas.height/2};
ball={x:player.x,y:player.y-20,vx:0,vy:0,owner:"player"};
}

function drawCircle(x,y,r,color){
ctx.fillStyle=color;
ctx.beginPath();
ctx.arc(x,y,r,0,Math.PI*2);
ctx.fill();
}

function distance(a,b){
return Math.hypot(a.x-b.x,a.y-b.y);
}

function loop(){
ctx.fillStyle="#1e90ff";
ctx.fillRect(0,0,canvas.width,canvas.height);

// porte
ctx.strokeStyle="white";
ctx.strokeRect(goalTop.x,goalTop.y,goalTop.w,goalTop.h);
ctx.strokeRect(goalBottom.x,goalBottom.y,goalBottom.w,goalBottom.h);

// BOT INSEGUE DAVVERO
if(ball.owner==="player"){
let dx=player.x-bot.x;
let dy=player.y-bot.y;
let d=Math.hypot(dx,dy);
if(d>1){
bot.x+=dx/d*1.5;
bot.y+=dy/d*1.5;
}
if(d<28){
ball.owner="bot";
}
}

// movimento palla
if(ball.owner==="player"){
ball.x=player.x;
ball.y=player.y-20;
}else if(ball.owner==="bot"){
ball.x=bot.x;
ball.y=bot.y+20;
}else{
ball.x+=ball.vx;
ball.y+=ball.vy;
}

// GOL CORRETTO
if(ball.x>goalTop.x && ball.x<goalTop.x+goalTop.w &&
   ball.y>goalTop.y && ball.y<goalTop.y+goalTop.h){
scoreY++; reset();
}

if(ball.x>goalBottom.x && ball.x<goalBottom.x+goalBottom.w &&
   ball.y>goalBottom.y && ball.y<goalBottom.y+goalBottom.h){
scoreR++; reset();
}

// disegno
drawCircle(player.x,player.y,18,"yellow");
drawCircle(bot.x,bot.y,18,"red");
drawCircle(ball.x,ball.y,7,"white");

document.getElementById("scoreY").innerText=scoreY;
document.getElementById("scoreR").innerText=scoreR;

requestAnimationFrame(loop);
}

// TIRO
function shoot(){
if(ball.owner==="player"){
ball.owner="free";
ball.vx=0;
ball.vy=-8;
}
}

// JOYSTICK
const joy=document.getElementById("joyY");
joy.style.left="30px";
joy.style.bottom="200px";

const stick=document.createElement("div");
stick.className="stick";
joy.appendChild(stick);

let active=false;
joy.ontouchstart=()=>active=true;
joy.ontouchend=()=>{
active=false;
stick.style.left="30px";
stick.style.top="30px";
};

joy.ontouchmove=e=>{
if(!active)return;
let r=joy.getBoundingClientRect();
let x=e.touches[0].clientX-r.left-50;
let y=e.touches[0].clientY-r.top-50;
let d=Math.hypot(x,y);
if(d>40){x=x/d*40;y=y/d*40;}
stick.style.left=50+x-20+"px";
stick.style.top=50+y-20+"px";
player.x+=x*0.1;
player.y+=y*0.1;
};
</script>
</body>
</html>
