<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Waterpolo Legends</title>

<link rel="apple-touch-icon" href="IMG_4537.jpeg">
<link rel="icon" href="IMG_4537.jpeg">

<style>
body { margin:0; background:#0b5ed7; overflow:hidden; font-family:Arial; }
canvas { display:block; }
#ui {
  position:fixed; top:10px; left:10px;
  color:white; font-size:18px;
}
#restart {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  padding:15px 25px;
  font-size:20px;
  background:white;
  border-radius:10px;
}
</style>
</head>

<body>
<canvas id="game"></canvas>
<div id="ui">‚è±Ô∏è <span id="time">60</span> | üèÜ <span id="score">0</span></div>
<button id="restart">Ricomincia</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let time = 60;
let score = 0;
let gameOver = false;

// Player
let player = { x: canvas.width/2, y: canvas.height-140 };

// Ball
let ball = { x: player.x, y: player.y-20, vx:0, vy:0, shooting:false };
let dragStart = null;

// Goal
let goal = { x: canvas.width/2-90, y: 40, w:180, h:20 };

function drawWater(){
  ctx.fillStyle="#1e90ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawGoal(){
  ctx.strokeStyle="white";
  ctx.lineWidth=4;
  ctx.strokeRect(goal.x,goal.y,goal.w,goal.h);
}

function drawPlayer(p){
  // body
  ctx.fillStyle="yellow";
  ctx.beginPath();
  ctx.arc(p.x,p.y,18,0,Math.PI*2);
  ctx.fill();

  // head
  ctx.fillStyle="#ffcc99";
  ctx.beginPath();
  ctx.arc(p.x,p.y-28,10,0,Math.PI*2);
  ctx.fill();

  // arms
  ctx.strokeStyle="yellow";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(p.x-20,p.y);
  ctx.lineTo(p.x+20,p.y);
  ctx.stroke();
}

function drawBall(){
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,7,0,Math.PI*2);
  ctx.fill();
}

function reset(){
  ball.shooting=false;
  ball.vx=0;
  ball.vy=0;
  ball.x=player.x;
  ball.y=player.y-20;
}

function update(){
  if(gameOver) return;

  drawWater();
  drawGoal();

  if(ball.shooting){
    ball.x+=ball.vx;
    ball.y+=ball.vy;

    // goal
    if(ball.y<goal.y+goal.h &&
       ball.x>goal.x && ball.x<goal.x+goal.w){
      score++;
      reset();
    }

    if(ball.y<0) reset();
  } else {
    ball.x=player.x;
    ball.y=player.y-20;
  }

  drawPlayer(player);
  drawBall();

  document.getElementById("score").innerText=score;
  requestAnimationFrame(update);
}

setInterval(()=>{
  if(time>0){
    time--;
    document.getElementById("time").innerText=time;
  } else {
    gameOver=true;
    document.getElementById("restart").style.display="block";
  }
},1000);

canvas.addEventListener("touchstart",e=>{
  const t=e.touches[0];
  dragStart={x:t.clientX,y:t.clientY};
});

canvas.addEventListener("touchend",e=>{
  if(!dragStart || ball.shooting) return;

  const dx=dragStart.x-e.changedTouches[0].clientX;
  const dy=dragStart.y-e.changedTouches[0].clientY;

  ball.vx=-dx*0.05;
  ball.vy=-dy*0.05;
  ball.shooting=true;
  dragStart=null;
});

document.getElementById("restart").onclick=()=>{
  score=0;
  time=60;
  gameOver=false;
  document.getElementById("restart").style.display="none";
  reset();
};

update();
</script>
</body>
</html>
