<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterpolo Legends</title>
<style>
body{margin:0;background:#1e90ff;overflow:hidden;font-family:Arial}
canvas{display:block}

#home{
position:fixed;top:50%;left:50%;
transform:translate(-50%,-50%);
background:white;padding:20px;
border-radius:15px;text-align:center;
}

#ui{
position:fixed;top:10px;left:10px;
color:white;font-size:18px;
}

.joy{
position:fixed;
width:100px;height:100px;
background:rgba(255,255,255,0.3);
border-radius:50%;
left:50%;transform:translateX(-50%);
}
#joyBottom{bottom:20px}
#joyTop{top:20px}

.stick{
width:40px;height:40px;
background:white;border-radius:50%;
position:absolute;left:30px;top:30px;
}

.controls{
position:fixed;right:10px;
display:flex;flex-direction:column;
}
#controlsBottom{bottom:20px}
#controlsTop{top:20px}

button{
padding:12px;
margin:6px;
border-radius:10px;
font-size:14px;
}

#restart{
position:fixed;top:50%;left:50%;
transform:translate(-50%,-50%);
display:none;
}
</style>
</head>

<body>

<div id="home">
<h2>Waterpolo Legends</h2>
<button onclick="startGame('bot')">ü§ñ Gioca contro BOT</button><br>
<button onclick="startGame('friend')">üë¨ Gioca contro AMICO</button>
</div>

<canvas id="game"></canvas>

<div id="ui">
‚è±Ô∏è <span id="time">60</span> |
üü° <span id="scoreY">0</span> - üî¥ <span id="scoreR">0</span>
</div>

<!-- JOYSTICK GIALLI (porta tua) -->
<div id="joyBottom" class="joy"><div id="stickBottom" class="stick"></div></div>
<div id="controlsBottom" class="controls">
<button onclick="passBall('Y')">PASSA</button>
<button onclick="shootBall('Y')">TIRA</button>
</div>

<!-- JOYSTICK ROSSI (porta avversaria) -->
<div id="joyTop" class="joy" style="display:none;">
<div id="stickTop" class="stick"></div>
</div>
<div id="controlsTop" class="controls" style="display:none;">
<button onclick="passBall('R')">PASSA</button>
<button onclick="shootBall('R')">TIRA</button>
</div>

<button id="restart" onclick="location.reload()">Ricomincia</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let mode="bot";
let time=60,scoreY=0,scoreR=0;
let teamY=[],teamR=[],ball;
let controlledY,controlledR;

const goalTop={x:canvas.width/2-100,y:30,w:200,h:20};
const goalBottom={x:canvas.width/2-100,y:canvas.height-50,w:200,h:20};

function startGame(m){
mode=m;
document.getElementById("home").style.display="none";
if(mode==="friend"){
document.getElementById("joyTop").style.display="block";
document.getElementById("controlsTop").style.display="flex";
}
resetAll();
loop();
}

function resetAll(){
teamY=[
{x:canvas.width/2,y:canvas.height-140},
{x:canvas.width/2-120,y:canvas.height-220},
{x:canvas.width/2+120,y:canvas.height-220}
];
teamR=(mode==="bot")?[
{x:canvas.width/2,y:canvas.height/2},
{x:canvas.width/2-140,y:canvas.height/2+60},
{x:canvas.width/2+140,y:canvas.height/2+60},
{x:canvas.width/2,y:canvas.height/2+120}
]:[
{x:canvas.width/2,y:canvas.height/2},
{x:canvas.width/2-140,y:canvas.height/2+60},
{x:canvas.width/2+140,y:canvas.height/2+60}
];
controlledY=teamY[0];
controlledR=teamR[0];
ball={owner:"Y"};
}

function drawPlayer(p,color){
ctx.fillStyle=color;
ctx.beginPath();ctx.arc(p.x,p.y,18,0,Math.PI*2);ctx.fill();
ctx.fillStyle="#f2c9a0";
ctx.beginPath();ctx.arc(p.x,p.y-24,9,0,Math.PI*2);ctx.fill();
}

function loop(){
ctx.fillStyle="#1e90ff";
ctx.fillRect(0,0,canvas.width,canvas.height);

// porte
ctx.strokeStyle="white";
ctx.strokeRect(goalTop.x,goalTop.y,goalTop.w,goalTop.h);
ctx.strokeRect(goalBottom.x,goalBottom.y,goalBottom.w,goalBottom.h);

// palla
let owner=ball.owner==="Y"?controlledY:controlledR;
ball.x=owner.x;
ball.y=owner.y-20;

// disegno
teamY.forEach(p=>drawPlayer(p,"yellow"));
teamR.forEach(p=>drawPlayer(p,"red"));

ctx.fillStyle="white";
ctx.beginPath();ctx.arc(ball.x,ball.y,7,0,Math.PI*2);ctx.fill();

requestAnimationFrame(loop);
}

// PASSA
function passBall(team){
let arr=team==="Y"?teamY:teamR;
let current=team==="Y"?controlledY:controlledR;
let target=arr.find(p=>p!==current);
if(team==="Y") controlledY=target;
else controlledR=target;
ball.owner=team;
}

// TIRA
function shootBall(team){
if(team==="Y"){
scoreY++;
resetAll();
}else{
scoreR++;
resetAll();
}
document.getElementById("scoreY").innerText=scoreY;
document.getElementById("scoreR").innerText=scoreR;
}

// JOYSTICK
function setupJoystick(joyId,stickId,move){
let joy=document.getElementById(joyId);
let stick=document.getElementById(stickId);
let active=false;

joy.ontouchstart=()=>active=true;
joy.ontouchend=()=>{
active=false;
stick.style.left="30px";
stick.style.top="30px";
};

joy.ontouchmove=e=>{
if(!active)return;
let r=joy.getBoundingClientRect();
let x=e.touches[0].clientX-r.left-50;
let y=e.touches[0].clientY-r.top-50;
let d=Math.hypot(x,y);
if(d>40){x=x/d*40;y=y/d*40;}
stick.style.left=50+x-20+"px";
stick.style.top=50+y-20+"px";
move(x,y);
};
}

setupJoystick("joyBottom","stickBottom",(dx,dy)=>{
controlledY.x+=dx*0.1;
controlledY.y+=dy*0.1;
});

setupJoystick("joyTop","stickTop",(dx,dy)=>{
if(mode==="friend"){
controlledR.x+=dx*0.1;
controlledR.y+=dy*0.1;
}
});
</script>
</body>
</html>
